function CertLogin() { var e = myobj.SetTokenType(2); if ("0" != e) alert("連結卡片失敗,Return Code:" + e + "ErrMsg:" + myobj.GetErrorMsg()), location.reload(); else { var t = myobj.GetCardStatus(); if (0 == t) { var o = document.getElementById("CertPwd"), r = myobj.Login(o.value); if (0 == r) { var a = myobj.SelectCert(2); if (0 == a) { var n = myobj.GetSelectedCertSubject(), l = n.split("/"), i = l[6]; i = i.split("=")[1]; var d = i.split("-"), g = d[2], s = "|", u = new Date, c = u.getFullYear() + "/" + (u.getMonth() + 1) + "/" + u.getDate() + " " + u.getHours() + ":" + u.getMinutes() + ":" + u.getSeconds(), m = getData(g, c, s), y = document.getElementById("Plaintext"); y.value = m; var E = myobj.SignPKCS7(m); if (0 == E) { var b = document.getElementById("SignData"); b.value = myobj.GetPKCS7Data() } else alert("簽章失敗,Return Code:" + E + "ErrMsg:" + myobj.GetErrorMsg() + "Funcation:SignPKCS7"), location.reload() } else alert("讀取憑證失敗,Return Code:" + a + "ErrMsg:" + myobj.GetErrorMsg() + "Funcation:SelectCert"), location.reload() } else alert("卡片登入失敗,Return Code:" + r + "ErrMsg:" + myobj.GetErrorMsg() + "Funcation:Login"), location.reload() } else alert("取得卡片狀態失敗,Return Code:" + t + "ErrMsg:" + myobj.GetErrorMsg() + "Funcation:SetTokenType"), location.reload() } } function getData(e, t, o) { return o + e + o + t } "undefined" == typeof myobj && document.write('<OBJECT id="myobj" codebase="POSTATX.cab#version=1,0,0,1" classid="clsid:D1504008-EB4C-4A2B-8BD7-2B19105A68AA" VIEWASTEXT></OBJECT>');